{% extends 'backoffice/base.html.twig' %}

{% block title %}Membres cliniques{% endblock %}
{% block page_title %}ðŸ‘¥ Clinic Memberships{% endblock %}

{% block body %}
<div style="margin-bottom: 20px;">
    <a href="{{ path('backoffice_clinic_memberships_new') }}" style="display: inline-block; padding: 10px 20px; background: #27ae60; color: white; text-decoration: none; border-radius: 4px; font-weight: 500;">
        âž• CrÃ©er une membership
    </a>
</div>

    <div class="card mb-4">
        <div class="card-header">Filtrer</div>
        <div class="card-body">
            <form method="get" action="{{ path('backoffice_clinic_memberships') }}" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Statut</label>
                    <select name="status" class="form-select">
                        <option value="">(tous)</option>
                        <option value="ACTIVE" {{ filters.status == 'ACTIVE' ? 'selected' : '' }}>Active</option>
                        <option value="DISABLED" {{ filters.status == 'DISABLED' ? 'selected' : '' }}>Disabled</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">RÃ´le</label>
                    <select name="role" class="form-select">
                        <option value="">(tous)</option>
                        <option value="CLINIC_ADMIN" {{ filters.role == 'CLINIC_ADMIN' ? 'selected' : '' }}>Clinic Admin</option>
                        <option value="VETERINARY" {{ filters.role == 'VETERINARY' ? 'selected' : '' }}>Veterinary</option>
                        <option value="ASSISTANT_VETERINARY" {{ filters.role == 'ASSISTANT_VETERINARY' ? 'selected' : '' }}>Assistant Veterinary</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Engagement</label>
                    <select name="engagement" class="form-select">
                        <option value="">(tous)</option>
                        <option value="EMPLOYEE" {{ filters.engagement == 'EMPLOYEE' ? 'selected' : '' }}>Employee</option>
                        <option value="CONTRACTOR" {{ filters.engagement == 'CONTRACTOR' ? 'selected' : '' }}>Contractor</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Clinic ID</label>
                    <input name="clinic_id" class="form-control" value="{{ filters.clinic_id }}">
                </div>
                <div class="col-md-3">
                    <label class="form-label">User ID</label>
                    <input name="user_id" class="form-control" value="{{ filters.user_id }}">
                </div>
                <div class="col-md-12">
                    <button class="btn btn-primary" type="submit">Rechercher</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            RÃ©sultats ({{ collection.total }})
        </div>
        <div class="card-body table-responsive">
            <table class="table table-striped table-sm align-middle">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Clinic</th>
                        <th>User</th>
                        <th>Role</th>
                        <th>Engagement</th>
                        <th>Status</th>
                        <th>Valid From</th>
                        <th>Valid Until</th>
                        <th style="width: 200px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                {% for membership in collection.memberships %}
                    <tr>
                        <td><small><code>{{ membership.membershipId|slice(0, 8) }}</code></small></td>
                        <td>
                            {{ membership.clinicName }}<br>
                            <small class="text-muted"><code>{{ membership.clinicId|slice(0, 8) }}</code></small>
                        </td>
                        <td>
                            {{ membership.userEmail }}<br>
                            <small class="text-muted"><code>{{ membership.userId|slice(0, 8) }}</code></small>
                        </td>
                        <td>
                            <span class="badge bg-info">{{ membership.role.value }}</span>
                        </td>
                        <td>
                            <span class="badge bg-secondary">{{ membership.engagement.value }}</span>
                        </td>
                        <td>
                            <span class="badge bg-{{ membership.status.value == 'ACTIVE' ? 'success' : 'danger' }}">
                                {{ membership.status.value }}
                            </span>
                        </td>
                        <td><small>{{ membership.validFrom|date('Y-m-d H:i') }}</small></td>
                        <td>
                            {% if membership.validUntil %}
                                <small>{{ membership.validUntil|date('Y-m-d H:i') }}</small>
                            {% else %}
                                <small class="text-muted">âˆž</small>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                {% if membership.status.value == 'ACTIVE' %}
                                    <form method="post" action="{{ path('backoffice_clinic_memberships_disable', {id: membership.membershipId}) }}" style="display:inline;">
                                        <input type="hidden" name="_token" value="{{ csrf_token }}">
                                        <button type="submit" class="btn btn-warning" onclick="return confirm('DÃ©sactiver cette membership ?')">Disable</button>
                                    </form>
                                {% else %}
                                    <form method="post" action="{{ path('backoffice_clinic_memberships_enable', {id: membership.membershipId}) }}" style="display:inline;">
                                        <input type="hidden" name="_token" value="{{ csrf_token }}">
                                        <button type="submit" class="btn btn-success">Enable</button>
                                    </form>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                {% else %}
                    <tr><td colspan="9" class="text-center">Aucun rÃ©sultat</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
