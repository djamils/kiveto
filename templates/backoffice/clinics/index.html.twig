{% extends 'base.html.twig' %}

{% block title %}Backoffice · Clinics{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1>Cliniques</h1>

    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ label == 'error' ? 'danger' : label }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endfor %}

    <div class="mb-3">
        <a href="{{ path('backoffice_clinics_new') }}" class="btn btn-success">Créer une clinique</a>
        <a href="{{ path('backoffice_clinic_groups') }}" class="btn btn-outline-secondary">Gérer les groupes</a>
    </div>

    <div class="card mb-4">
        <div class="card-header">Filtrer</div>
        <div class="card-body">
            <form method="get" action="{{ path('backoffice_clinics') }}" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Statut</label>
                    <select name="status" class="form-select">
                        <option value="">(tous)</option>
                        <option value="active" {{ filters.status == 'active' ? 'selected' : '' }}>Active</option>
                        <option value="suspended" {{ filters.status == 'suspended' ? 'selected' : '' }}>Suspended</option>
                        <option value="closed" {{ filters.status == 'closed' ? 'selected' : '' }}>Closed</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Groupe</label>
                    <select name="group_id" class="form-select">
                        <option value="">(tous)</option>
                        {% for group in groups.clinicGroups %}
                            <option value="{{ group.id }}" {{ filters.group_id == group.id ? 'selected' : '' }}>{{ group.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Recherche (nom ou slug)</label>
                    <input name="search" class="form-control" value="{{ filters.search }}">
                </div>
                <div class="col-md-12">
                    <button class="btn btn-primary" type="submit">Rechercher</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            Résultats ({{ collection.total }})
        </div>
        <div class="card-body table-responsive">
            <table class="table table-striped align-middle">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nom</th>
                        <th>Slug</th>
                        <th>Timezone</th>
                        <th>Locale</th>
                        <th>Statut</th>
                        <th>Groupe</th>
                        <th style="width: 150px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                {% for clinic in collection.clinics %}
                    <tr>
                        <td><small><code>{{ clinic.id|slice(0, 8) }}</code></small></td>
                        <td>{{ clinic.name }}</td>
                        <td><code>{{ clinic.slug }}</code></td>
                        <td>{{ clinic.timeZone }}</td>
                        <td>{{ clinic.locale }}</td>
                        <td>
                            <span class="badge bg-{{ clinic.status.value == 'active' ? 'success' : (clinic.status.value == 'suspended' ? 'warning' : 'danger') }}">
                                {{ clinic.status.value }}
                            </span>
                        </td>
                        <td>
                            {% if clinic.clinicGroupId %}
                                <small><code>{{ clinic.clinicGroupId|slice(0, 8) }}</code></small>
                            {% else %}
                                —
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ path('backoffice_clinics_edit', {id: clinic.id}) }}" class="btn btn-sm btn-outline-primary">Éditer</a>
                        </td>
                    </tr>
                {% else %}
                    <tr><td colspan="8" class="text-center">Aucun résultat</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
